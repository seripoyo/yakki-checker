---
allowed-tools: Read, Glob, Grep, Edit, MultiEdit, Write, Bash, TodoWrite, mcp__serena__check_onboarding_performed, mcp__serena__delete_memory, mcp__serena__find_file, mcp__serena__find_referencing_symbols, mcp__serena__find_symbol, mcp__serena__get_symbols_overview, mcp__serena__insert_after_symbol, mcp__serena__insert_before_symbol, mcp__serena__list_dir, mcp__serena__list_memories, mcp__serena__onboarding, mcp__serena__read_memory, mcp__serena__remove_project, mcp__serena__replace_regex, mcp__serena__replace_symbol_body, mcp__serena__restart_language_server, mcp__serena__search_for_pattern, mcp__serena__switch_modes, mcp__serena__think_about_collected_information, mcp__serena__think_about_task_adherence, mcp__serena__think_about_whether_you_are_done, mcp__serena__write_memory, mcp__context7__resolve-library-id, mcp__context7__get-library-docs
description: Token-efficient Serena MCP command for structured app development and problem-solving
---

## クイックリファレンス

```bash
/serena <問題> [オプション]              # 基本的な使い方
/serena debug "本番環境のメモリリーク"    # デバッグパターン (5-8の思考ステップ)
/serena design "認証システム"            # 設計パターン (8-12の思考ステップ)  
/serena review "このコードを最適化"       # レビューパターン (4-7の思考ステップ)
/serena implement "機能Xを追加"          # 実装パターン (6-10の思考ステップ)
```

## オプション一覧

| オプション | 説明 | 使用例 | 適用場面 |
|--------|-------------|-------|----------|
| `-q` | クイックモード (3-5の思考ステップ) | `/serena "ボタンを修正" -q` | 簡単なバグ、小規模な機能 |
| `-d` | ディープモード (10-15の思考ステップ) | `/serena "アーキテクチャ設計" -d` | 複雑なシステム、重要な決定 |
| `-c` | コード重視の分析 | `/serena "パフォーマンスを最適化" -c` | コードレビュー、リファクタリング |
| `-s` | ステップバイステップの実装 | `/serena "ダッシュボードを構築" -s` | 完全な機能開発 |
| `-v` | 詳細出力 (プロセスを表示) | `/serena "問題をデバッグ" -v` | 学習、プロセスの理解 |
| `-r` | リサーチフェーズを含む | `/serena "フレームワークを選択" -r` | 技術選定 |
| `-t` | 実装タスクを作成 | `/serena "新機能" -t` | プロジェクト管理 |

## 使用パターン

### 基本的な使い方
```bash
# シンプルな問題解決
/serena "ログインバグを修正"

# 素早い機能実装  
/serena "検索フィルターを追加" -q

# コード最適化
/serena "読み込み時間を改善" -c
```

### 高度な使い方
```bash
# リサーチを含む複雑なシステム設計
/serena "マイクロサービスアーキテクチャを設計" -d -r -v

# タスク管理を含む完全な機能開発
/serena "チャート付きユーザーダッシュボードを実装" -s -t -c

# ドキュメント付きの詳細分析
/serena "新フレームワークへ移行" -d -r -v --focus=frontend
```

## コンテキスト（自動収集）
- プロジェクトファイル: !`find . -maxdepth 2 -name "package.json" -o -name "*.config.*" | head -5 2>/dev/null || echo "設定ファイルなし"`
- Gitステータス: !`git status --porcelain 2>/dev/null | head -3 || echo "Gitリポジトリではありません"`

## コアワークフロー

### 1. 問題検出とテンプレート選択
キーワードに基づいて思考パターンを自動選択：
- **デバッグ**: エラー、バグ、不具合、壊れた、失敗 → 5-8の思考ステップ
- **設計**: アーキテクチャ、システム、構造、計画 → 8-12の思考ステップ  
- **実装**: 構築、作成、追加、機能 → 6-10の思考ステップ
- **最適化**: パフォーマンス、遅い、改善、リファクタリング → 4-7の思考ステップ
- **レビュー**: 分析、チェック、評価 → 4-7の思考ステップ

### 2. MCP選択と実行
```
アプリ開発タスク → Serena MCP
- コンポーネント実装
- API開発
- 機能構築
- システムアーキテクチャ

すべてのタスク → Serena MCP
- コンポーネント実装
- API開発 
- 機能構築
- システムアーキテクチャ
- 問題解決と分析
```

### 3. 出力モード
- **デフォルト**: 重要な洞察 + 推奨アクション
- **詳細 (-v)**: 思考プロセスを表示
- **実装 (-s)**: タスク作成 + 実行開始

## 問題別テンプレート

### デバッグパターン (5-8の思考ステップ)
1. 症状分析と再現手順
2. エラーコンテキストと環境確認  
3. 根本原因の仮説立案
4. 証拠収集と検証
5. 解決策設計とリスク評価
6. 実装計画
7. 検証戦略
8. 再発防止策

### 設計パターン (8-12の思考ステップ)  
1. 要件の明確化
2. 制約条件と前提事項
3. ステークホルダー分析
4. アーキテクチャ案の生成
5. 各案の評価（長所/短所）
6. 技術選定
7. 設計決定とトレードオフ
8. 実装フェーズ
9. リスク軽減策
10. 成功指標
11. 検証計画
12. ドキュメント要件

### 実装パターン (6-10の思考ステップ)
1. 機能仕様とスコープ定義
2. 技術的アプローチの選択
3. コンポーネント/モジュール設計
4. 依存関係と統合ポイント
5. 実装順序
6. テスト戦略
7. エッジケース処理
8. パフォーマンス考慮事項
9. エラー処理とリカバリー
10. デプロイとロールバック計画

### レビュー/最適化パターン (4-7の思考ステップ)
1. 現状分析
2. ボトルネック特定
3. 改善機会の発見
4. 解決策オプションと実現可能性
5. 実装優先度
6. パフォーマンス影響の推定
7. 検証とモニタリング計画

## 高度なオプション

**思考制御:**
- `--max-thoughts=N`: デフォルトの思考数を上書き
- `--focus=領域`: 特定領域の分析 (frontend、backend、database、security)
- `--token-budget=N`: トークン制限に最適化

**統合:**
- `-r`: Context7リサーチフェーズを含める
- `-t`: 実装タスクを作成
- `--context=ファイル`: 特定ファイルを先に分析

**出力:**
- `--summary`: 要約のみ出力
- `--json`: 自動化用の構造化出力
- `--progressive`: 要約を先に表示、詳細は要求時に表示

## タスク実行

あなたはSerena MCPを主に使用する専門的なアプリ開発者であり問題解決者です。各リクエストに対して：

1. **問題タイプを自動検出**して適切なアプローチを選択
2. **Serena MCPを使用**：
   - **すべての開発タスク**: Serena MCPツール (https://github.com/oraios/serena) を使用
   - **分析、デバッグ、実装**: Serenaのセマンティックコードツールを使用
3. 選択したMCPで**構造化されたアプローチを実行**
4. 必要に応じてContext7 MCPで**関連ドキュメントをリサーチ**
5. 具体的な次のステップを含む**実行可能な解決策を統合**
6. `-s`フラグ使用時は**実装タスクを作成**

**主要ガイドライン:**
- **最優先**: すべてのタスク（コンポーネント、API、機能、分析）でSerena MCPツールを使用
- **活用**: Serenaのセマンティックコード検索と編集機能を最大限活用
- 問題分析から開始し、具体的なアクションで終了
- 深さとトークン効率のバランスを保つ
- 常に具体的で実行可能な推奨事項を提供
- セキュリティ、パフォーマンス、保守性を考慮

**トークン効率化のコツ:**
- シンプルな問題には `-q` を使用（約40%のトークン節約）
- 概要のみ必要な場合は `--summary` を使用  
- 関連する問題を1つのセッションにまとめる
- 無関係な分析を避けるために `--focus` を使用


## 📚 使用パターン別解説

### 1. 基本的な使用方法

```bash
# シンプルな問題解決
/serena "ログインバグ修正"
# → 自動的にデバッグパターンを選択し、5-8ステップで問題を解決

# 高速な機能実装（クイックモード）
/serena "検索フィルター追加" -q
# → 3-5ステップの簡潔な実装プロセス

# コード最適化（コードフォーカス）
/serena "読み込み時間改善" -c
# → コード分析に特化した最適化提案
```

### 2. 高度な使用方法

```bash
# 複雑なシステム設計（リサーチ付き）
/serena "マイクロサービスアーキテクチャ設計" -d -r -v
# -d: ディープモード（10-15ステップ）
# -r: 技術リサーチを含む
# -v: 思考プロセスを詳細表示

# フル機能開発（TODO作成付き）
/serena "チャート付きユーザーダッシュボード実装" -s -t -c
# -s: ステップバイステップ実装
# -t: 実装タスクをTODOとして作成
# -c: コード重視の分析

# 深層分析（ドキュメント付き）
/serena "新フレームワークへの移行" -d -r -v --focus=frontend
# --focus=frontend: フロントエンド領域に特化した分析
```

## 🎯 問題タイプ別の自動選択

Serenaは**キーワードベース**で最適な思考パターンを自動選択します：

### 🐛 デバッグパターン（5-8思考ステップ）

**トリガーキーワード**: `error`, `bug`, `issue`, `broken`, `failing`, `エラー`, `バグ`, `不具合`, `壊れた`, `失敗`

```bash
/serena "APIエラーが発生している"
```

**実行される思考プロセス:**
1. 🔍 **症状分析** - エラーメッセージと発生状況を詳細に分析
2. 🌍 **環境確認** - 開発/本番環境、依存関係をチェック
3. 💡 **原因仮説** - 可能性のある原因を複数リストアップ
4. 🔬 **検証** - 各仮説を順次検証
5. 🛠️ **解決策** - 最適な修正方法を提案
6. 📝 **実装** - 具体的なコード変更を実施
7. ✅ **検証戦略** - 修正が正しく動作することを確認
8. 🛡️ **予防措置** - 再発防止策を提案

### 🏗️ 設計パターン（8-12思考ステップ）

**トリガーキーワード**: `architecture`, `system`, `structure`, `plan`, `設計`, `アーキテクチャ`, `システム`, `構造`

```bash
/serena "ユーザー認証システム設計"
```

**実行される思考プロセス:**
1. 📋 **要件整理** - ビジネス要件と技術要件を明確化
2. 🚧 **制約確認** - 予算、時間、技術的制約を把握
3. 👥 **ステークホルダー分析** - 関係者のニーズを理解
4. 🎨 **選択肢生成** - 複数のアーキテクチャ案を作成
5. ⚖️ **評価** - 各案のメリット・デメリットを比較
6. 🔧 **技術選定** - 最適な技術スタックを決定
7. 📐 **設計決定** - アーキテクチャとトレードオフを決定
8. 📅 **実装フェーズ** - 段階的な実装計画を策定
9. ⚠️ **リスク軽減** - 潜在的リスクへの対策
10. 📊 **成功指標** - KPIと評価基準を設定
11. 🔍 **検証計画** - テストと検証の戦略
12. 📚 **ドキュメント** - 必要な文書を作成

### ⚡ 実装パターン（6-10思考ステップ）

**トリガーキーワード**: `build`, `create`, `add`, `feature`, `実装`, `構築`, `作成`, `追加`, `機能`

```bash
/serena "リアルタイムチャット機能追加"
```

**実行される思考プロセス:**
1. 📝 **仕様確認** - 機能要件とスコープを定義
2. 🎯 **技術選定** - 実装アプローチを決定
3. 🏛️ **設計** - コンポーネント構造を設計
4. 🔗 **依存関係** - 統合ポイントを特定
5. 📋 **実装順序** - 開発の優先順位を決定
6. 🧪 **テスト戦略** - テスト計画を策定
7. 🛡️ **エッジケース** - 例外処理を設計
8. ⚡ **パフォーマンス** - 最適化ポイントを特定
9. 🚨 **エラーハンドリング** - エラー処理とリカバリー
10. 🚀 **デプロイ計画** - リリースとロールバック戦略

### 🚀 最適化パターン（4-7思考ステップ）

**トリガーキーワード**: `performance`, `slow`, `improve`, `refactor`, `最適化`, `遅い`, `改善`, `リファクタリング`

```bash
/serena "データベースクエリ最適化"
```

**実行される思考プロセス:**
1. 📈 **現状分析** - パフォーマンスメトリクスを測定
2. 🎯 **ボトルネック特定** - 問題箇所を特定
3. 💡 **改善機会** - 最適化可能な箇所をリストアップ
4. 🔄 **解決選択肢** - 複数の改善案を比較
5. 📊 **優先度** - 実装の優先順位を決定
6. 📉 **実装影響評価** - パフォーマンス向上の予測
7. ✅ **検証計画** - 改善効果の測定方法

## 💡 実践的な使用例

### ケース1: 緊急バグ修正
```bash
# 本番環境の緊急バグ
/serena "決済処理でNullPointerException発生" -q -v
# -q: 素早い対応が必要
# -v: デバッグ過程を詳細に表示
```

### ケース2: 新機能の完全実装
```bash
# ゼロから機能を構築
/serena "多言語対応機能を実装" -s -t -r
# -s: ステップバイステップで実装
# -t: TODOリスト作成
# -r: 最適なi18nライブラリをリサーチ
```

### ケース3: パフォーマンス改善
```bash
# 既存コードの最適化
/serena "React コンポーネントの再レンダリング最適化" -c --focus=frontend
# -c: コード分析に特化
# --focus=frontend: フロントエンドに焦点
```

### ケース4: アーキテクチャ設計
```bash
# 大規模システムの設計
/serena "イベントドリブンアーキテクチャへの移行計画" -d -r -v --summary
# -d: 深い分析（10-15ステップ）
# -r: 技術調査を含む
# -v: プロセスを表示
# --summary: 最後に要約を生成
```

## 🎮 オプションの組み合わせ戦略

### 初心者向け
```bash
/serena "簡単な修正" -q -v
# クイックモードで、プロセスを見ながら学習
```

### 中級者向け
```bash
/serena "機能追加" -s -t
# 段階的実装とタスク管理
```

### 上級者向け
```bash
/serena "システム最適化" -d -c --token-budget=1000
# 深い分析をトークン制限内で実行
```

## 📊 効果的な使い分け

| 状況 | 推奨コマンド | 理由 |
|------|------------|------|
| 緊急対応 | `-q -v` | 素早く、かつプロセスを確認 |
| 新規開発 | `-s -t -r` | 段階的にタスク管理しながら開発 |
| コードレビュー | `-c --summary` | コードに焦点を当てて要約 |
| 設計検討 | `-d -r -v` | 深く調査し、思考過程を共有 |
| 学習目的 | `-v --progressive` | プロセスを見ながら段階的に理解 |

## 🔍 トラブルシューティング

### よくある質問

**Q: 思考ステップが多すぎる場合は？**
```bash
/serena "問題" --max-thoughts=5
# 思考ステップを5つに制限
```

**Q: 特定の領域だけ分析したい場合は？**
```bash
/serena "問題" --focus=backend
# バックエンドに特化した分析
# 選択肢: frontend, backend, database, security
```

**Q: トークンを節約したい場合は？**
```bash
/serena "問題" -q --summary
# クイックモード + 要約のみ = 最大60%節約
```