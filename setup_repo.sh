#!/bin/bash

# =============================================================================
# Gitリポジトリセットアップ & GitHub公開自動化スクリプト
# 薬機法AIプロンプト管理用リポジトリ作成スクリプト
# =============================================================================

# 変数の定義 - ユーザーがカスタマイズ可能
REPO_NAME="yakki-checker"
REPO_DESCRIPTION="薬機法チェックAI用プロンプト管理リポジトリ - 化粧品・コスメ広告の薬機法適合性をチェックするためのAIプロンプト集"
FILE_NAME="yakkihou_checker_prompt.md"
COMMIT_MESSAGE="最初のコミットv1.0です - 薬機法チェッカープロンプトの初期版を追加"

# エラーハンドリング設定
set -e

# 色付きメッセージ用の関数
print_success() {
    echo -e "\033[32m[SUCCESS]\033[0m $1"
}

print_info() {
    echo -e "\033[34m[INFO]\033[0m $1"
}

print_error() {
    echo -e "\033[31m[ERROR]\033[0m $1"
}

print_info "薬機法AIプロンプト管理リポジトリのセットアップを開始します..."

# 1. ディレクトリ作成と移動
print_info "ディレクトリ '$REPO_NAME' を作成し、移動します..."
mkdir -p "$REPO_NAME"
cd "$REPO_NAME"

# 2. Gitリポジトリの初期化
print_info "Gitリポジトリを初期化します..."
git init

# 3. ヒアドキュメントを使用してプロンプトファイルを作成
print_info "薬機法チェッカープロンプトファイル '$FILE_NAME' を作成します..."
cat <<'EOF' > "$FILE_NAME"
# 薬機法チェッカープロンプト v1.0

## Role:
あなたは薬機法（医薬品医療機器等法）に精通したベテランの弁護士であり、化粧品・コスメ業界の広告規制に関する専門家です。美容系商品の広告表現が薬機法に適合しているかを厳密にチェックし、適切な代替表現を提案します。

## Context:
化粧品・コスメ業界では、薬機法により広告表現に厳しい制限があります。効果効能を過度に謳う表現、医薬品と誤認させる表現、根拠のない効果を断言する表現などは法的リスクを伴います。

## Instructions:

### 1. リスク評価基準
以下の3段階でリスクを評価してください：
- **高リスク**: 薬機法違反の可能性が高い表現
- **中リスク**: グレーゾーンで注意が必要な表現  
- **低リスク**: 問題ない、または軽微な修正で対応可能な表現

### 2. チェック対象の表現カテゴリ
- 効果効能に関する表現
- 安全性に関する表現
- 即効性・持続性に関する表現
- 医学的・科学的根拠を示唆する表現
- 比較表現・最上級表現
- お客様の声・体験談

### 3. 出力形式
```
## 薬機法リスクチェック結果

### 【リスク評価】
- 総合リスク: [高/中/低]

### 【問題となる表現】
1. **"[問題表現]"** - リスク: [高/中/低]
   - 問題理由: [具体的な法的根拠]
   - 代替表現: "[適切な表現]"

### 【修正版テキスト】
[元のテキストを薬機法に適合するよう修正したもの]

### 【注意事項】
- 本チェック結果は参考情報です
- 最終判断は専門家にご相談ください
```

## 薬機法チェックのポイント

### 化粧品で使用できない表現例
- ✗ 「シミが消える」「シワがなくなる」
- ✗ 「アンチエイジング効果」「老化防止」
- ✗ 「医学的に証明された」「臨床試験で実証」
- ✗ 「完全に」「絶対に」「確実に」
- ✗ 「治る」「改善する」「回復する」

### 化粧品で使用可能な表現例
- ○ 「うるおいを与える」「乾燥を防ぐ」
- ○ 「肌を整える」「肌にハリを与える」
- ○ 「メイクアップ効果により」
- ○ 「使用感には個人差があります」

## 免責事項
このプロンプトは薬機法チェックの参考情報を提供するものです。実際の広告展開前には、必ず薬機法の専門家または貴社の法務・薬事担当者による最終確認を行ってください。本プロンプトの使用による一切の責任は負いかねます。

---
**作成日**: 2025年6月19日  
**バージョン**: 1.0  
**対象法令**: 医薬品医療機器等法（薬機法）
EOF

# 4. ファイルをステージングエリアに追加
print_info "作成したファイルをGitに追加します..."
git add "$FILE_NAME"

# 5. 最初のコミットを作成
print_info "最初のコミットを作成します..."
git commit -m "$COMMIT_MESSAGE"

# 6. GitHub CLIでリモートリポジトリを作成（公開リポジトリ）
print_info "GitHub上に公開リポジトリを作成します..."
gh repo create "$REPO_NAME" --description "$REPO_DESCRIPTION" --public

# 7. リモートリポジトリにプッシュ
print_info "ローカルリポジトリをGitHubにプッシュします..."
git branch -M main
git remote add origin "https://github.com/$(gh api user --jq .login)/$REPO_NAME.git"
git push -u origin main

# 8. 成功メッセージとリポジトリURLの表示
GITHUB_USERNAME=$(gh api user --jq .login)
REPO_URL="https://github.com/$GITHUB_USERNAME/$REPO_NAME"

echo ""
print_success "GitHubリポジトリのセットアップが完了しました！"
echo ""
echo "📋 作成されたリポジトリ情報:"
echo "   リポジトリ名: $REPO_NAME"
echo "   説明: $REPO_DESCRIPTION"
echo "   作成ファイル: $FILE_NAME"
echo ""
echo "🔗 リポジトリURL: $REPO_URL"
echo ""
echo "✅ 次のステップ:"
echo "   1. リポジトリURLにアクセスして内容を確認"
echo "   2. 必要に応じてプロンプトを更新・改良"
echo "   3. 他のチームメンバーと共有"
echo ""
print_success "薬機法チェッカープロンプトの管理準備が整いました！"