<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ä¿®æ­£å¾Œã®å‹•ä½œç¢ºèª</title>
    <style>
        body { padding: 20px; font-family: sans-serif; max-width: 1200px; margin: 0 auto; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .warning { color: orange; font-weight: bold; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 5px; }
        button:hover { background: #0056b3; }
        #status { background: #f8f8f8; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .log-entry { margin: 5px 0; padding: 5px; background: white; border-left: 3px solid #007bff; }
        .fix-item { margin: 10px 0; padding: 10px; background: #f0f8ff; border-radius: 5px; }
        .fix-item h3 { margin-top: 0; color: #007bff; }
    </style>
</head>
<body>
    <h1>ğŸ”§ è–¬æ©Ÿæ³•ãƒã‚§ãƒƒã‚«ãƒ¼ ä¿®æ­£ç¢ºèª</h1>
    
    <div class="test-section">
        <h2>å®Ÿæ–½ã—ãŸä¿®æ­£å†…å®¹</h2>
        
        <div class="fix-item">
            <h3>1. äºŒé‡ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ã®ä¿®æ­£</h3>
            <p>âœ… streaming.js:74è¡Œç›®ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ</p>
            <p>â†’ script.jså´ã§ã®ã¿ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ã‚’è¡Œã†ã‚ˆã†ã«çµ±ä¸€</p>
        </div>
        
        <div class="fix-item">
            <h3>2. é‡è¤‡å®Ÿè¡Œé˜²æ­¢ãƒ•ãƒ©ã‚°ã®è¿½åŠ </h3>
            <p>âœ… script.js:307è¡Œç›®ã«isProcessingãƒ•ãƒ©ã‚°ã‚’è¿½åŠ </p>
            <p>â†’ ãƒã‚§ãƒƒã‚¯å‡¦ç†ä¸­ã¯æ–°ã—ã„ãƒã‚§ãƒƒã‚¯ã‚’é–‹å§‹ã—ãªã„ã‚ˆã†ã«åˆ¶å¾¡</p>
        </div>
        
        <div class="fix-item">
            <h3>3. APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®"ä¸æ˜"ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«å¯¾å¿œ</h3>
            <p>âœ… api.js:816-818è¡Œç›®ã§"ä¸æ˜"ã‚’"ä¸­"ã«è‡ªå‹•å¤‰æ›</p>
            <p>â†’ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®äº’æ›æ€§å•é¡Œã‚’å›é¿</p>
        </div>
    </div>
    
    <div class="test-section">
        <h2>å‹•ä½œç¢ºèª</h2>
        <div id="status">åˆæœŸåŒ–ä¸­...</div>
        
        <button id="test-simple">ç°¡å˜ãªãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
        <button id="test-complex">è¤‡é›‘ãªãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
        <button id="test-error">ã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
        <button id="clear-log">ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
        
        <h3>ãƒ†ã‚¹ãƒˆãƒ­ã‚°</h3>
        <div id="test-log"></div>
    </div>
    
    <!-- JavaScriptèª­ã¿è¾¼ã¿ -->
    <script src="setting/frontend/js/config.js"></script>
    <script src="setting/frontend/js/security.js"></script>
    <script src="setting/frontend/js/api.js"></script>
    <script src="setting/frontend/js/quickCheck.js"></script>
    <script src="setting/frontend/js/streaming.js"></script>
    <script src="setting/frontend/js/ui.js"></script>
    <script src="setting/frontend/js/script.js"></script>
    
    <script>
        const statusDiv = document.getElementById('status');
        const logDiv = document.getElementById('test-log');
        
        function addLog(message, type = 'info') {
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.innerHTML = `<span class="${type}">[${new Date().toLocaleTimeString()}]</span> ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        // åˆæœŸåŒ–
        window.addEventListener('load', async function() {
            try {
                // APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç¢ºèª
                if (window.yakkiApiClient) {
                    statusDiv.innerHTML = '<span class="success">âœ… APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåˆæœŸåŒ–å®Œäº†</span>';
                    addLog('APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåˆæœŸåŒ–æˆåŠŸ', 'success');
                    
                    // ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
                    const health = await window.yakkiApiClient.healthCheck();
                    addLog(`ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æ¥ç¶šç¢ºèª: ${health.status}`, 'success');
                } else {
                    statusDiv.innerHTML = '<span class="error">âŒ APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåˆæœŸåŒ–å¤±æ•—</span>';
                    addLog('APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåˆæœŸåŒ–å¤±æ•—', 'error');
                }
                
                // é‡è¤‡å®Ÿè¡Œé˜²æ­¢ãƒ•ãƒ©ã‚°ã®ç¢ºèª
                if (typeof isProcessing !== 'undefined') {
                    addLog('é‡è¤‡å®Ÿè¡Œé˜²æ­¢ãƒ•ãƒ©ã‚°: æœ‰åŠ¹', 'success');
                } else {
                    addLog('é‡è¤‡å®Ÿè¡Œé˜²æ­¢ãƒ•ãƒ©ã‚°: ç„¡åŠ¹', 'warning');
                }
                
            } catch (error) {
                statusDiv.innerHTML = `<span class="error">âŒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}</span>`;
                addLog(`åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        });
        
        // ç°¡å˜ãªãƒ†ã‚¹ãƒˆ
        document.getElementById('test-simple').addEventListener('click', async function() {
            addLog('ç°¡å˜ãªãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
            
            try {
                const result = await window.yakkiApiClient.checkText(
                    'å¥åº·ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ã‚µãƒ—ãƒªãƒ¡ãƒ³ãƒˆ',
                    'ã‚µãƒ—ãƒªãƒ¡ãƒ³ãƒˆ',
                    'å•†å“èª¬æ˜æ–‡ãƒ»åºƒå‘Šæ–‡ãƒ»é€šå¸¸ãƒ†ã‚­ã‚¹ãƒˆ',
                    ''
                );
                
                addLog(`âœ… ãƒ†ã‚¹ãƒˆæˆåŠŸ: ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ« ${result.overall_risk}`, 'success');
                addLog(`æ¤œå‡ºä»¶æ•°: é«˜${result.risk_counts.high} ä¸­${result.risk_counts.medium} ä½${result.risk_counts.low}`, 'info');
                
            } catch (error) {
                addLog(`âŒ ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`, 'error');
            }
        });
        
        // è¤‡é›‘ãªãƒ†ã‚¹ãƒˆï¼ˆé‡è¤‡å®Ÿè¡Œé˜²æ­¢ç¢ºèªï¼‰
        document.getElementById('test-complex').addEventListener('click', async function() {
            addLog('è¤‡é›‘ãªãƒ†ã‚¹ãƒˆé–‹å§‹ï¼ˆé‡è¤‡å®Ÿè¡Œé˜²æ­¢ç¢ºèªï¼‰', 'info');
            
            // 2å›é€£ç¶šã§å®Ÿè¡Œã‚’è©¦ã¿ã‚‹
            const promise1 = window.yakkiApiClient.checkText(
                'ã“ã®ã‚µãƒ—ãƒªã§ç—›ã¿ãŒæ¶ˆãˆãŸï¼',
                'ã‚µãƒ—ãƒªãƒ¡ãƒ³ãƒˆ',
                'å•†å“èª¬æ˜æ–‡ãƒ»åºƒå‘Šæ–‡ãƒ»é€šå¸¸ãƒ†ã‚­ã‚¹ãƒˆ',
                ''
            );
            
            const promise2 = window.yakkiApiClient.checkText(
                'ã“ã®ã‚µãƒ—ãƒªã§ç—›ã¿ãŒæ¶ˆãˆãŸï¼',
                'ã‚µãƒ—ãƒªãƒ¡ãƒ³ãƒˆ',
                'å•†å“èª¬æ˜æ–‡ãƒ»åºƒå‘Šæ–‡ãƒ»é€šå¸¸ãƒ†ã‚­ã‚¹ãƒˆ',
                ''
            );
            
            try {
                const [result1, result2] = await Promise.all([promise1, promise2]);
                addLog('âœ… ä¸¡æ–¹ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæˆåŠŸï¼ˆé‡è¤‡å®Ÿè¡Œé˜²æ­¢ãŒæ­£ã—ãæ©Ÿèƒ½ï¼‰', 'success');
            } catch (error) {
                addLog(`ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'warning');
            }
        });
        
        // ã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆ
        document.getElementById('test-error').addEventListener('click', async function() {
            addLog('ã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
            
            try {
                // ä¸æ­£ãªã‚«ãƒ†ã‚´ãƒªã§ãƒ†ã‚¹ãƒˆ
                const result = await window.yakkiApiClient.checkText(
                    'ãƒ†ã‚¹ãƒˆãƒ†ã‚­ã‚¹ãƒˆ',
                    'ä¸æ­£ãªã‚«ãƒ†ã‚´ãƒª',
                    'å•†å“èª¬æ˜æ–‡ãƒ»åºƒå‘Šæ–‡ãƒ»é€šå¸¸ãƒ†ã‚­ã‚¹ãƒˆ',
                    ''
                );
                
                addLog('äºˆæœŸã—ãªã„æˆåŠŸ', 'warning');
            } catch (error) {
                addLog(`âœ… æœŸå¾…é€šã‚Šã®ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'success');
            }
        });
        
        // ãƒ­ã‚°ã‚¯ãƒªã‚¢
        document.getElementById('clear-log').addEventListener('click', function() {
            logDiv.innerHTML = '';
            addLog('ãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ', 'info');
        });
    </script>
</body>
</html>