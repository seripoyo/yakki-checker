# 薬機法リスクチェッカー 要件定義書

- **バージョン:** 1.0
- **作成日:** 2025年6月19日

---

## 1. 概要

### 1.1. 本書の目的
本書は、Webアプリケーション「薬機法リスクチェッカー」の開発にあたり、その仕様、機能、要件を明確に定義することを目的とする。開発者および関係者は、本書を正として開発を進める。

### 1.2. 開発背景と目的
美容業界（サロン、化粧品メーカー）の広告・制作担当者や、専門知識を持たない外部デザイナー・ライターは、広告表現における薬機法遵守に課題を抱えている。自身の知識への不安や、専門部署への確認で生じる頻繁な手戻りにより、業務効率が低下している。

本アプリは、これらの担当者が広告文のラフ案を手軽に一次チェックできる環境を提供することで、**手戻りを削減し、制作スピードを向上させること**を主目的とする。

---

## 2. アプリケーションの基本仕様

### 2.1. アプリ名（案）
薬機法リスクチェッカー

### 2.2. コンセプト
薬機法に不慣れな広告・制作担当者のための、手軽で直感的な一次チェック＆リライト支援ツール

### 2.3. ターゲットユーザー
- 美容サロンの広告担当者、オーナー
- 化粧品メーカーの広告担当者
- 美容系の記事・LP・バナー等の制作を請け負うデザイナー、ライター

---

## 3. 機能要件

### 3.1. 画面構成
本アプリは、以下の2つの主要なタブで構成される。

1.  **リスクチェッカータブ:** メイン機能。テキストを入力し、薬機法リスクをチェックする。
2.  **薬機法簡単ガイドタブ:** サブ機能。薬機法初心者向けの解説コンテンツを提供する。

### 3.2. リスクチェッカー機能
#### 3.2.1. 入力仕様
1.  ユーザーは、まずチェックしたい文章の種類を以下の選択肢から選ぶ。
    - `キャッチコピー`
    - `商品説明文`
    - `お客様の声`
2.  指定されたテキストエリアに、チェックしたい文章をコピー＆ペーストで入力する。
3.  「チェック開始」ボタンをクリックすることで、チェック処理が実行される。

#### 3.2.2. 出力・表示仕様
「チェック開始」ボタン押下後、結果表示エリアに以下の情報が整形されて表示される。

1.  **総合リスクレベル:** テキスト全体のリスクを「高」「中」「低」の3段階で表示する。
    > 例: `総合リスクレベル: 高`
2.  **リスク件数サマリー:** 検出されたリスクの件数を表示する。
    > 例:
    > - 総検出数: 3
    > - 高リスク: 1
    > - 中リスク: 2
    > - 低リスク: 0
3.  **詳細結果（2カラム表示）:**
    - **左カラム（入力文表示エリア）:**
        - ユーザーが入力した文章がそのまま表示される。
        - AIによって指摘された問題箇所がハイライト（例: `<mark>`タグによる黄色マーカー）される。
    - **右カラム（解説エリア）:**
        - 指摘事項がリスト形式で表示される。
        - 各指摘事項には、以下の情報が含まれる。
            - **問題の表現:** ハイライトされた具体的なテキスト
            - **抵触の理由:** なぜ薬機法に抵触する可能性があるかの具体的解説
            - **リスクレベル:** 「高」「中」「低」の個別評価
            - **代替表現の提案:** 3つ程度の具体的な言い換え候補
4.  **全文リライト案:**
    - 指摘事項を反映し、広告効果を維持しつつ薬機法に準拠するようAIがリライトした全文を提示する。
5.  **インタラクション:**
    - 左カラムのハイライト箇所をクリックすると、右カラムの対応する指摘事項解説へ自動でスクロールする。

### 3.3. 薬機法簡単ガイド機能
- **目的:** 薬機法の知識がない、または浅いユーザーへの啓蒙と、アプリへの理解促進。
- **コンテンツ:** 化粧品広告等で頻出するNG表現や、その考え方、OKな言い換え例などを、図や平易な文章を用いて分かりやすく解説する。

---

## 4. AIおよびシステム要件

### 4.1. AIチェックロジック
- **知識ソース:**
    1.  **プライマリ:** Notionに格納された、薬機法に関するドキュメント（NoteBookLM, Gemini等で精査・整理された情報）。
    2.  **補助:** アプリケーションのディレクトリ内に配置された「NG広告例.csv」ファイル。
- **連携方法:** Claude Code APIは、MCP（iPaaS連携ツール等を想定）を介してNotionから情報を取得する。
- **出力形式:** AIは、フロントエンドでの処理を容易にするため、必ず以下のJSON形式で応答を返すこと。

```json
{
  "overall_risk": "高" | "中" | "低",
  "risk_counts": {
    "total": Number,
    "high": Number,
    "medium": Number,
    "low": Number
  },
  "issues": [
    {
      "fragment": "問題のある表現",
      "reason": "抵触する理由...",
      "risk_level": "高" | "中" | "低",
      "suggestions": ["代替案1", "代替案2", "代替案3"]
    }
  ],
  "rewritten_text": "リライトされた全文..."
}

### 4.2. AIプロンプト仕様

以下が薬機法リスクチェッカーのバックエンドAIに送信される具体的なプロンプト内容である。

```markdown
# Role: 
あなたは、日本の薬機法（医薬品、医療機器等の品質、有効性及び安全性の確保等に関する法律）に精通した、最高のリーガルチェックAIアシスタントです。あなたのタスクは、入力された美容関連の広告テキストを分析し、薬機法抵触リスクを評価して、具体的な改善案をJSON形式で出力することです。

# Context:
このAIは、美容サロンや化粧品メーカーの広告担当者、薬機法に不慣れなライター向けの「薬機法リスクチェッカー」というWebアプリのバックエンドとして機能します。目的は、担当者が作成した広告文のラフ案を手軽に一次チェックし、専門家への確認前に手戻りを減らすことです。

# Input Data:
- text: {ここにチェックしたい文章を挿入}
- type: "{キャッチコピー | 商品説明文 | お客様の声}"

# Reference Data (CSV):
(ここにNG広告例CSVの内容を貼り付けるか、ファイルから読み込ませる指示を記述)
---
NG表現,カテゴリ
"シミが消える",シミ
"アンチエイジング",老化
...
---

# Instructions:
入力された `text` と `type`、そして参考資料 `Reference Data (CSV)` を基に、以下のタスクを厳密に実行してください。

1.  **全体リスク評価:** テキスト全体としての薬機法抵触リスクを「高」「中」「低」の3段階で評価してください。
2.  **問題点の抽出と分析:**
    * テキスト内から、薬機法に抵触する可能性のある全ての表現 (`fragment`) を特定してください。
    * 特定した各表現について、抵触の具体的な理由 (`reason`)、リスクレベル (`risk_level`) を評価してください。
    * リスク評価に基づいた、安全な代替表現の候補 (`suggestions`) を3つ提案してください。
3.  **全文リライト:** 指摘事項を全て修正し、広告効果をできるだけ維持したまま、薬機法に準拠した文章 (`rewritten_text`) を生成してください。
4.  **リスク件数集計:** 高・中・低リスクの件数をそれぞれカウントしてください。

# Output Format:
必ず以下のJSON形式で、キーの名前も厳密に守って出力してください。他の説明文は一切含めないでください。

{
  "overall_risk": "高",
  "risk_counts": {
    "total": 1,
    "high": 1,
    "medium": 0,
    "low": 0
  },
  "issues": [
    {
      "fragment": "シミが完全に消える",
      "reason": "化粧品の効能効果の範囲を逸脱し、医薬品的な効果（シミの治療）を暗示しているため、薬機法違反となる可能性が非常に高いです。",
      "risk_level": "高",
      "suggestions": [
        "メラニンの生成を抑え、シミ・そばかすを防ぐ",
        "乾燥による小じわを目立たなくする",
        "キメを整え、明るい印象の肌へ導く"
      ]
    }
  ],
  "rewritten_text": "この美容液は、メラニンの生成を抑え、シミ・そばかすを防ぎます。キメを整えることで、あなたのお肌を明るい印象へと導きます。"
}
```

---

## 5. 非機能要件

### 5.1. 免責事項

アプリケーション内のフッター等、常に視認できる場所に以下の趣旨の免責事項を明記する。

- 本アプリのチェック結果は、広告表現の適法性を保証するものではありません。
- あくまで作成担当者のための参考情報としてご利用ください。
- 本ツール使用時の最終的な広告表現の判断は、必ず貴社の法務・薬事担当者または専門家にご相談ください。

### 5.2. ビジネス要件（外部リンク）

免責事項の下に、外部の専門サービスへ誘導するためのボタンを設置する。

- **ボタン文言:** `薬機法チェックを依頼する`
- **デザイン:** オレンジ色など、目立つ配色とする。
- **リンク先:** 指定された専門家の相談窓口URL。

